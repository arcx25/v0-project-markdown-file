{% extends "base.html" %}

{% block title %}Dashboard - ARCHITECT // VAULT{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Updated dashboard sidebar with buyer/vendor roles -->
    <aside class="dashboard-sidebar">
        <div class="user-info">
            <span class="username">{{ user.username }}</span>
            <span class="role-badge">{{ user.role.value | title }}</span>
        </div>
        
        <nav class="sidebar-nav">
            <a href="/dashboard" class="sidebar-link active">
                Dashboard
            </a>
            
            {% if user.role.value == 'buyer' %}
            <a href="/dashboard/opportunities" class="sidebar-link">
                My Opportunities
            </a>
            <a href="/marketplace" class="sidebar-link">
                Browse Vendors
            </a>
            {% elif user.role.value == 'vendor' %}
            <a href="/dashboard/interests" class="sidebar-link">
                My Interests
            </a>
            <a href="/marketplace" class="sidebar-link">
                Browse Opportunities
            </a>
            <a href="/dashboard/subscription" class="sidebar-link">
                Subscription
            </a>
            {% elif user.role.value == 'admin' %}
            <a href="/admin" class="sidebar-link">
                Admin Panel
            </a>
            {% endif %}
            
            <a href="/dashboard/listings" class="sidebar-link">
                Support Listings
            </a>
            <a href="/dashboard/messages" class="sidebar-link">
                Messages
            </a>
            <a href="/dashboard/settings" class="sidebar-link">
                Settings
            </a>
            
            <form method="POST" action="/api/auth/logout" class="logout-link">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <button type="submit" class="sidebar-link" style="width: 100%; text-align: left;">
                    Logout
                </button>
            </form>
        </nav>
    </aside>
    
    <main class="dashboard-main">
        <header class="page-header">
            <h1>Dashboard</h1>
            <p class="text-muted">Welcome back, {{ user.username }}</p>
        </header>
        
        <!-- Stats grid adapted for buyer/vendor marketplace -->
        <div class="stats-grid">
            {% if user.role.value == 'buyer' %}
            <div class="stat-card">
                <span class="stat-value">{{ stats.active_opportunities or 0 }}</span>
                <span class="stat-label">Active Opportunities</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ stats.vendor_interests or 0 }}</span>
                <span class="stat-label">Vendor Interests</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ stats.active_conversations or 0 }}</span>
                <span class="stat-label">Conversations</span>
            </div>
            {% elif user.role.value == 'vendor' %}
            <div class="stat-card">
                <span class="stat-value">{{ stats.interests_submitted or 0 }}</span>
                <span class="stat-label">Interests Submitted</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ stats.interests_accepted or 0 }}</span>
                <span class="stat-label">Accepted</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ stats.active_conversations or 0 }}</span>
                <span class="stat-label">Conversations</span>
            </div>
            {% endif %}
        </div>
        
        <!-- Role-specific content -->
        {% if user.role.value == 'buyer' %}
            {% include "dashboard/_buyer_opportunities.html" %}
        {% elif user.role.value == 'vendor' %}
            {% include "dashboard/_vendor_interests.html" %}
        {% elif user.role.value == 'admin' %}
            <div class="admin-quick-links">
                <a href="/admin/leads" class="card">
                    <h3>Review Opportunities</h3>
                    <p>{{ stats.pending_leads or 0 }} pending</p>
                </a>
                <a href="/admin/vendors" class="card">
                    <h3>Verify Vendors</h3>
                    <p>{{ stats.pending_vendors or 0 }} pending</p>
                </a>
                <a href="/admin/listings" class="card">
                    <h3>Review Listings</h3>
                    <p>{{ stats.pending_listings or 0 }} pending</p>
                </a>
            </div>
        {% endif %}
    </main>
</div>
{% endblock %}
